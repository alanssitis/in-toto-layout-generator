expires = "2024-01-01 00:00"

[signing-key]
uri = "bob"

[keys.my-pubkey-1]
uri = "hashicorp-vault://server1/transit-secrets-engine/my-pubkey-1"
backend = "https://github.com/secure-systems-lab/securesystemslib/signer/_hashicorp_vault_signer.py"
scheme = "rsassa-pss-sha256"

[keys.my-pubkey-2]
uri = "aws-kms://arn:<partition>:kms:<region>:<account-id>:key/<key-id>"
backend = "https://github.com/secure-systems-lab/securesystemslib/signer/_aws_kms_signer.py"
scheme = "ed25519"

[keys.my-pubkey-3]
uri = "fulcio://someone@example.com"
backend = "https://github.com/secure-systems-lab/securesystemslib/signer/_tap123_signer.py"

[[steps]]
name = "clone"
expected_command = "git clone 'https://github.com/in-toto/demo-project.git'"
expected_products = ["CREATE demo-project/foo.py"]
pubkeys = ["my-pubkey-1"]

[[steps]]
name = "update-version"
expected_materials = ["MATCH demo-project/* WITH PRODUCTS FROM clone"]
expected_products = ["MODIFY demo-project/foo.py"]
pubkeys = ["my-pubkey-2"]

[[steps]]
name = "package"
expected_command = "tar --exclude .git -zcvf demo-project.tar.gz demo-project"
expected_materials = ["MATCH 'demo-project/*' WITH PRODUCTS FROM update-version"]
expected_products = ["CREATE demo-project.tar.gz"]
pubkeys = ["my-pubkey-3"]

[[inspect]]
name = "untar"
expected_materials = [
  "MATCH demo-project.tar.gz WITH PRODUCTS FROM package",
  "ALLOW .keep",
  "ALLOW alice.pub",
  "ALLOW root.layout",
]
expected_products = [
  "MATCH demo-project/foo.py WITH PRODUCTS FROM update-version",
  "ALLOW demo-project/.git/*",
  "ALLOW demo-project.tar.gz",
  "ALLOW .keep",
  "ALLOW alice.pub",
  "ALLOW root.layout",
]
run = "tar xzf demo-project.tar.gz"
